name: purchase_requisitions
label: 采购需求
icon: contact
enable_api: true
fields:
  name:
    type: autonumber
    formula: "PR{00000}"
    label: 单号
    searchable: true
    filterable: true
    index: true
    omit: true
    readonly: true
  amount_qty:
    type: number
    label: 合计数量
    omit: true
  state:
    label: 状态
    type: select
    sortable: true
    options:
      - label: 待询价
        value: draft
      - label: 已询价
        value: sent
    defaultValue: draft
    filterable: true
  owner:
    label: 编制

list_views:
  all:
    label: 所有
    columns:
      - state
      - name
      - created
      - user_id
      - amount_qty
      - owner

relatedList:
  - purchase_requisitions_lines
  - objectName: purchase_quotations 
    columns: 
      - state
      - name
      - partner_id
      - quotation_date
      - amount_untaxed
      - amount_total
      - user_id
    filters: !!js/function | 
      function(parentRecord) {
        var id = parentRecord._id;
        return [["requisition_id","=",id]]
      }
    sort: 
      - - date_order
        - asc
  - objectName: purchase_orders 
    columns: 
      - state
      - name
      - partner_id
      - order_date
      - amount_untaxed
      - amount_total
      - user_id
    filters: !!js/function | 
      function(parentRecord) {
        var id = parentRecord._id;
        return [["requisition_id","=",id]]
      }
    sort: 
      - - date_order
        - asc

actions:
  printPR: 
      label: "打印需求单"

permission_set:
  user:
    allowCreate: false
    allowDelete: false
    allowEdit: false
    allowRead: true
    modifyAllRecords: false
    viewAllRecords: true 
  admin:
    allowCreate: true
    allowDelete: true
    allowEdit: true
    allowRead: true
    modifyAllRecords: true
    viewAllRecords: true
